!function(e){function t(e,t,n){var m=e.clone().attr("id","comment-"+t.id);return n&&m.addClass(n),t.author.id!==o&&(m.find(".comment-delete").remove(),m.find(".comment-edit").remove()),m.data("id",t.id),m.find(".comment-author").text(t.author.name),m.find(".comment-avatar").css("background-image","url("+t.author.avatar+")"),m.find(".comment-content").text(t.content),m.find(".comment-posted").text(t.created_at),m.show(),m}function n(e){return function(t){t.preventDefault();var n=t.target.elements,o=+n.parent.value,m={content:n.content.value,parent:0!==o?o:null};m.content.length>5&&r.addComment(m).done(function(n){e&&e(n),t.target.reset(),console.log(n)})}}var o=1,m=e("#comments"),a=e("#comment_tpl"),c=e(".commentsList"),r={api_url:"http://frontend-test.pingbull.com/pages/ruslan@lobarev.com/comments",getCommentsList:function(t,n){return e.get({url:this.api_url,dateType:"json"},{count:t||5,offset:n||0})},addComment:function(t){return e.ajax({url:this.api_url,type:"POST",dateType:"json",data:t})},deleteComment:function(t){return e.ajax({url:this.api_url+"/"+t,type:"POST",dateType:"json",data:{_method:"DELETE"}})},editComment:function(t){return e.ajax({url:this.api_url+"/"+t,type:"POST",dateType:"json",data:{_method:"PUT"}})},getComment:function(t){return e.get({url:this.api_url+"/"+t,dateType:"json"})}};r.getCommentsList(10).then(function(e){console.log(e),e.map(function(e){var n=t(a,e);if(c.append(n),e.children.length>0){var o=n.find(".comment-children");e.children.map(function(e){o.append(t(a,e,"comment--child"))})}})}),e("#app_comments_form").on("submit",n(function(e){c.prepend(t(a,e))})),e(m).on("click",".js-show-reply",function(o){o.preventDefault();var m=e(this).closest(".comment"),c=m.find(".comment-replyForm").first(),r=e("#app_comments_form").clone().attr("id",""),i=e("<a>").addClass("comment-closeReplyForm js-close-reply-form").text("Cancel");r[0].elements.parent.value=m.data("id"),r[0].elements.content.value="",c.append(i).append(r),r.on("submit",n(function(e){i.trigger("click"),m.find(".comment-children").first().append(t(a,e,"comment--child"))}))}),e(m).on("click",".js-close-reply-form",function(t){t.preventDefault(),e(this).closest(".comment-replyForm").html("")}),e(m).on("click",".js-delete-comment",function(t){t.preventDefault();var n=e(this).closest(".comment"),o=n.data("id");r.deleteComment(o).then(function(){confirm("Are you sure you want to delete you comment?")&&n.remove()})}),e(m).on("click",".js-edit-comment",function(t){t.preventDefault();var n=e(this).closest(".comment").data("id"),o=e("#app_comments_form");r.getComment(n).then(function(t){o[0].elements.id.value=t.id,o[0].elements.parent.value=t.parent,o[0].elements.content.value=t.content;var n=o.offset().top;e("body").scrollTop(n)})})}($);